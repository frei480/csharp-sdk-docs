

Руководство по T-FLEX CAD Open API

# Преобразование координат  
    
Для вывода изображения на графическое устройство данный класс производит преобразование передаваемых вещественных координат, заданных в мировой системе координат, в целочисленные координаты графического устройства. Параметры данного преобразования могут быть получены при помощи ряда специальных методов:

  * конструктор класса [Graphics](T_TFlex_Drawing_Graphics.md) принимает на вход два прямоугольника: целочисленный прямоугольник в системе координат графического устройства и вещественный прямоугольник, соответствующий ему, в мировой системе координат. Параметры преобразования координат вычисляются таким образом, что прямоугольник в мировой системе координат целиком вписывается в прямоугольник в системе координат графического устройства без искажений;
  * метод [LCSRectangle](P_TFlex_Drawing_Graphics_LCSRectangle.md) позволяет получить прямоугольник в системе координат графического устройства;
  * метод [WCSRectangle](P_TFlex_Drawing_Graphics_WCSRectangle.md) позволяет получить прямоугольник в мировой системе координат;
  * метод [Scale](P_TFlex_Drawing_Graphics_Scale.md) позволяет получить масштаб преобразования в систему координат графического устройства. Необходимо отметить, что вывод изображения производится без искажений по осям. Соответственно масштабы по осям X и Y имеют одинаковые значения;
  * метод [GetLCSPoint](M_TFlex_Drawing_Graphics_GetLCSPoint.md) позволяет получить координаты точки в системе координат графического устройства, соответствующей точке в мировой системе координат;
  * метод [GetWCSPoint](M_TFlex_Drawing_Graphics_GetWCSPoint.md) позволяет получить координаты точки в мировой системе координат, соответствующей точке в системе координат устройства;



Ниже приведен пример обработчика события [Paint](https://learn.microsoft.com/dotnet/api/system.windows.forms.control.paint) для элемента управления [PictureBox](https://learn.microsoft.com/dotnet/api/system.windows.forms.picturebox), в котором происходит отображение документа, увеличенного в два раза по обеим осям, в этом элементе управления. Для увеличения изображения документа изменяются координаты его левого нижнего и правого верхнего углов. 
    
    
    private Document document;
    private TFlex.Drawing.Graphics _grph;
    
    private void MyPictureBox_Paint(object sender, PaintEventArgs e)
    {
        if (document != null)
        {
            IntPtr hdc = e.Graphics.GetHdc();
            if (_grph == null)
                _grph = new TFlex.Drawing.Graphics(Handle, new System.Drawing.Rectangle(new Point(0, 0), new Size(0, 0)), new TFlex.Drawing.Rectangle(0, 0, 0, 0));
            _grph.LCSRectangle = ClientRectangle;
            TFlex.Drawing.Rectangle rect = new TFlex.Drawing.Rectangle();
            rect.Left = document.ActivePage.Rectangle.Left + document.ActivePage.Rectangle.Width * 0.25;
            rect.Right = document.ActivePage.Rectangle.Right - document.ActivePage.Rectangle.Width * 0.25;
            rect.Bottom = document.ActivePage.Rectangle.Bottom + document.ActivePage.Rectangle.Height * 0.25;
            rect.Top = document.ActivePage.Rectangle.Top - document.ActivePage.Rectangle.Height * 0.25;
            _grph.WCSRectangle = rect;
            _grph.DeviceContext = hdc;
            document.Draw(_grph, document.ActivePage);
            _grph.ReleaseDeviceContext(hdc);
            e.Graphics.ReleaseHdc(hdc);
            _grph = null;
        }
    }
    
    
    Private document As Document
    Private _grph As TFlex.Drawing.Graphics
    
    Private Sub MyPictureBox_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles MyPictureBox.Paint
        If Not document Is Nothing Then
            Dim hdc As IntPtr
            hdc = e.Graphics.GetHdc()
            If _grph Is Nothing Then
                _grph = New TFlex.Drawing.Graphics(Handle, New System.Drawing.Rectangle(New Point(0, 0), New Size(0, 0)), New TFlex.Drawing.Rectangle(0, 0, 0, 0))
            End If
            _grph.LCSRectangle = ClientRectangle
            Dim rect As TFlex.Drawing.Rectangle = New TFlex.Drawing.Rectangle()
            rect.Left = document.ActivePage.Rectangle.Left + document.ActivePage.Rectangle.Width * 0.25
            rect.Right = document.ActivePage.Rectangle.Right - document.ActivePage.Rectangle.Width * 0.25
            rect.Bottom = document.ActivePage.Rectangle.Bottom + document.ActivePage.Rectangle.Height * 0.25
            rect.Top = document.ActivePage.Rectangle.Top - document.ActivePage.Rectangle.Height * 0.25
            _grph.WCSRectangle = rect
            _grph.DeviceContext = hdc
            document.Draw(_grph, document.ActivePage)
            _grph.ReleaseDeviceContext(hdc)
            e.Graphics.ReleaseHdc(hdc)
            _grph = Nothing
        End If
    End Sub

В настоящее время язык не поддерживается либо пример кода отсутствует.

#### Другие ресурсы

[Общее управление документом](8d010394-3687-49aa-8d8c-49a855f0ebec.md)

[Класс Graphics. Общие положения](fd0e70f9-6abc-42ad-896b-9ae7523ad12e.md)

[Вспомогательные структуры подсистемы вывода двухмерной графики](62d0fc1e-8909-403b-8a4d-a84b30894bb1.md)