

Руководство по T-FLEX CAD Open API

# Изменение таблицы  
        
    
    public static void CreateTable()
    {
            Document document = TFlex.Application.ActiveDocument;
            document.BeginChanges("_");
    
            MultilineText mt = new MultilineText(document);
            mt.BeginEdit();
            mt.X = 100;
            mt.Y = 200;
    
            ParaFormat pt = mt.ParagraphFormat;
            pt.HorJustification =  ParaFormat.Just.Center;
            mt.ParagraphFormat = pt;
    
            mt.InsertText("Таблица штуцеров");
            mt.InsertCommonSymbol(CommonSymbol.LineBreak);
    
            Table.CreationSettings sett = new Table.CreationSettings(7, 2);
            Table table = mt.CreateTable(sett);
    
            Table.CellProperties prop = table.Properties;
            prop.TextDirection = Table.TextDirection.BottomToTop;
            prop.CellWidth = 20;
            prop.RowHeight = 50; 
            prop.RowHeightMode = SizeMode.Auto;
            prop.RowWrap = false;
            prop.CellTextVAlign = Table.TextVAlign.Center;
            prop.TableHAlign = Table.TableHAlign.Center;
            prop.HalfCellSpace.Horizontal = 0;
            prop.HalfCellSpace.Vertical = 0;
    
            table.SetCellHeight(0, 300, SizeMode.Exact);
    
            table.SetCellProperties(0, prop);
            table.InsertText(0, 0, "Обозначение");
    
            prop.TextDirection = Table.TextDirection.Normal;
            prop.CellWidth = 70;
            table.SetCellProperties(1, prop);
            table.InsertText(1, 0, "Назначение штуцеров");
    
            prop.CellWidth = 15;
            table.SetCellProperties(2, prop);
            table.InsertText(2, 0, "Кол.");
    
            table.SetCellProperties(3, prop);
            table.InsertText(3, 0, "DN, мм");
            table.InsertText(4, 0, "PN");
    
            prop.CellWidth = 34;
            table.SetCellProperties(6, prop);
            table.InsertText(6, 0, "Примечание");
    
            table.MergeCells(4, 5);
    
            table.MergeCells(0, 6);
            table.MergeCells(1, 6);
            table.MergeCells(2, 6);
            table.MergeCells(3, 6);
    
            prop.CellWidth = 20;
            table.SetCellProperties(6, prop);
            table.InsertText(6, 0, "МПа");
    
            table.SetCellProperties(7, prop);
            table.InsertText(7, 0, "кгc/с м");
    
            mt.InsertIndex("2", "");
    
            CharFormat cf =table.CharFormat;
            cf.VertOffset = 30;
            table.InsertText(7, 0, "2", cf);
    
            table.MergeCells(5, 8);
    
            mt.EndEdit();    
            document.EndChanges();
    }
    //Изменение текста в таблице
    public static void GetTable()
    {
        Document document = TFlex.Application.ActiveDocument;
        document.BeginChanges("_");
    
        foreach(var n in document.GetObjects())
        {
            if (n is MultilineText)
            {
                MultilineText mt = (MultilineText)n;
                mt.BeginEdit();
    
                Table tbl = (Table)mt.GetFirstTable();
                Table.CellProperties prop = tbl.GetCellProperties(1);
    
                tbl.InsertRows(1, 7, Table.InsertProperties.After); 
                tbl.InsertText(8, 0, "1");
    
                tbl.InsertText(9, 0, "старый текст");
                mt.EndEdit();
                document.EndChanges();
    
                document.BeginChanges("_");
                MessageBox.Show("очистка ячейки");
    
                mt.BeginEdit();
                tbl.Clear(9);
                mt.EndEdit();
    
                document.EndChanges();
    
                document.BeginChanges("_");
                MessageBox.Show("вставка нового значения в ячейку");
    
                mt.BeginEdit();
                tbl.InsertText(9, 0, "новый текст");
                mt.EndEdit();
    
                document.EndChanges();
                break;
            }
        }
    
        document.EndChanges();
    }