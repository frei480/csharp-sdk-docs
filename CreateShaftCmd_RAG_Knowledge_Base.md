# База знаний CreateShaftCmd для RAG-системы T-Flex CAD API

## Общая информация

**Название класса:** CreateShaftCmd
**Пространство имен:** TFlex.Shaft.Plugin.Commands
**Тип:** Команда (Command)
**Назначение:** Реализует команду создания трехмерной модели вала в системе T-Flex CAD

## Описание

CreateShaftCmd - это класс команды, который реализует функциональность создания трехмерной модели вала в системе T-Flex CAD. Класс наследуется от базового класса ShaftCommand и реализует интерфейс ICommand. CreateShaftCmd отвечает за создание геометрических примитивов вала, управление локальными координатными системами, установку переменных и регенерацию документа.

## Структура класса

### Свойства

#### Data
**Тип:** ShaftData
**Описание:** Данные вала для создания
**Назначение:** Хранит информацию о конструкции создаваемого вала
**Допустимые значения:** null или объект ShaftData

#### Document
**Тип:** Document
**Описание:** Документ T-Flex CAD
**Назначение:** Хранит ссылку на текущий документ системы
**Допустимые значения:** null или объект Document

#### ModelObject
**Тип:** ModelObject
**Описание:** Созданный объект модели вала
**Назначение:** Хранит ссылку на созданный объект модели
**Допустимые значения:** null или объект ModelObject

#### Fragment
**Тип:** Fragment3D
**Описание:** Фрагмент трехмерной модели
**Назначение:** Хранит ссылку на фрагмент созданной модели
**Допустимые значения:** null или объект Fragment3D

#### IsCreated
**Тип:** bool
**Описание:** Флаг создания модели
**Назначение:** Указывает, была ли создана модель вала
**Значения:** true/false

#### CreationDate
**Тип:** DateTime
**Описание:** Дата создания модели
**Назначение:** Хранит дату создания трехмерной модели вала
**Ограничения:** Не может быть минимальной датой

#### Parameters
**Тип:** Dictionary<string, string>
**Описание:** Параметры создания модели
**Назначение:** Хранит параметры и переменные созданной модели
**Ограничения:** Может быть пустым, но не null

### Конструкторы

#### Конструктор по умолчанию
```csharp
public CreateShaftCmd()
{
    Parameters = new Dictionary<string, string>();
    CreationDate = DateTime.Now;
    IsCreated = false;
}
```

#### Конструктор с параметрами данных
```csharp
public CreateShaftCmd(ShaftData data)
{
    Data = data;
    Parameters = new Dictionary<string, string>();
    CreationDate = DateTime.Now;
    IsCreated = false;
}
```

## API информация

### Методы

#### Run(Document doc, ShaftData data)
**Возвращаемый тип:** bool
**Описание:** Выполняет команду создания вала
**Назначение:** Основной метод для создания трехмерной модели вала
**Параметры:** 
- doc (Document) - документ T-Flex CAD
- data (ShaftData) - данные вала для создания
**Исключения:** 
- ArgumentNullException если doc или data равен null
- InvalidOperationException если команда уже выполнена

#### CreateShaft()
**Возвращаемый тип:** bool
**Описание:** Создает трехмерную модель вала
**Назначение:** Внутренний метод для создания модели вала
**Параметры:** Нет
**Исключения:** InvalidOperationException если Document или Data равен null

#### CreatePrimitives()
**Возвращаемый тип:** void
**Описание:** Создает геометрические примитивы вала
**Назначение:** Создает основные геометрические объекты ступеней вала
**Параметры:** Нет
**Исключения:** InvalidOperationException если Document или Data равен null

#### CreateLCS()
**Возвращаемый тип:** void
**Описание:** Создает локальные координатные системы
**Назначение:** Создает локальные системы координат для ступеней вала
**Параметры:** Нет
**Исключения:** InvalidOperationException если Document или Data равен null

#### CreateVariablesInFragment()
**Возвращаемый тип:** void
**Описание:** Создает переменные в фрагменте
**Назначение:** Устанавливает параметрические переменные для созданной модели
**Параметры:** Нет
**Исключения:** InvalidOperationException если Fragment равен null

#### SetFragmentVariable(string variableName, string expression)
**Возвращаемый тип:** void
**Описание:** Устанавливает переменную фрагмента
**Назначение:** Устанавливает значение параметрической переменной фрагмента
**Параметры:** 
- variableName (string) - имя переменной
- expression (string) - выражение для переменной
**Исключения:** 
- ArgumentNullException если variableName равен null
- InvalidOperationException если Fragment равен null

#### RegenerateDoc()
**Возвращаемый тип:** void
**Описание:** Регенерирует документ
**Назначение:** Обновляет отображение документа после создания модели
**Параметры:** Нет
**Исключения:** InvalidOperationException если Document равен null

#### Clear()
**Возвращаемый тип:** void
**Описание:** Очищает созданные объекты
**Назначение:** Удаляет созданные объекты модели и сбрасывает состояние команды
**Параметры:** Нет
**Исключения:** Не генерирует исключений

#### Validate()
**Возвращаемый тип:** bool
**Описание:** Проверяет возможность выполнения команды
**Назначение:** Проверяет корректность данных перед выполнением команды
**Параметры:** Нет
**Исключения:** Не генерирует исключений

#### ToString()
**Возвращаемый тип:** string
**Описание:** Возвращает строковое представление команды
**Назначение:** Используется для отображения информации о команде
**Параметры:** Нет
**Исключения:** Не генерирует исключений

#### GetParameter(string key)
**Возвращаемый тип:** string
**Описание:** Получает значение параметра команды
**Назначение:** Используется для доступа к параметрам команды
**Параметры:** key (string) - ключ параметра
**Исключения:** ArgumentException если параметр не найден

#### SetParameter(string key, string value)
**Возвращаемый тип:** void
**Описание:** Устанавливает значение параметра команды
**Назначение:** Используется для установки параметров команды
**Параметры:** 
- key (string) - ключ параметра
- value (string) - значение параметра
**Исключения:** Не генерирует исключений

### События

#### CreationCompleted
**Тип:** EventHandler<EventArgs>
**Описание:** Событие завершения создания
**Назначение:** Уведомляет подписчиков о завершении создания модели вала
**Параметры:** sender (object), e (EventArgs)

#### CreationFailed
**Тип:** EventHandler<CreationErrorEventArgs>
**Описание:** Событие ошибки создания
**Назначение:** Уведомляет подписчиков о возникновении ошибки при создании модели
**Параметры:** sender (object), e (CreationErrorEventArgs)

## Использование в коде

### Пример выполнения команды создания вала

```csharp
// Создание команды создания вала
CreateShaftCmd createShaftCmd = new CreateShaftCmd();

// Подготовка данных вала
ShaftData shaftData = new ShaftData("Основной вал", "Основной вал редуктора");
shaftData.Material = "Сталь 45";
shaftData.Standard = "ГОСТ 12081-76";

// Добавление ступеней
ShaftStep step1 = new ShaftStep(PrimitiveType.Cylinder, 50.0, 100.0)
{
    Name = "Основная ступень",
    Position = 0.0
};
shaftData.AddStep(step1);

ShaftStep step2 = new ShaftStep(PrimitiveType.Cone, 60.0, 50.0)
{
    Name = "Коническая ступень",
    Position = 100.0
};
shaftData.AddStep(step2);

// Добавление отверстий
ShaftHole hole1 = new ShaftHole(HoleType.Radial, 10.0, 50.0)
{
    Name = "Радиальное отверстие",
    Angle = 0.0,
    Offset = 25.0
};
shaftData.AddHole(hole1);

// Получение текущего документа T-Flex CAD
Document currentDoc = DocumentManager.CurrentDocument;

// Выполнение команды создания вала
try
{
    if (createShaftCmd.Run(currentDoc, shaftData))
    {
        Console.WriteLine("Вал успешно создан");
        Console.WriteLine($"Дата создания: {createShaftCmd.CreationDate}");
        
        // Подписка на события
        createShaftCmd.CreationCompleted += (sender, e) => {
            Console.WriteLine("Создание вала завершено");
        };
        
        createShaftCmd.CreationFailed += (sender, e) => {
            Console.WriteLine($"Ошибка создания вала: {e.ErrorMessage}");
        };
    }
    else
    {
        Console.WriteLine("Не удалось создать вал");
    }
}
catch (Exception ex)
{
    Console.WriteLine($"Ошибка при выполнении команды: {ex.Message}");
}
```

### Пример работы с параметрами команды

```csharp
// Создание команды с параметрами
CreateShaftCmd createShaftCmd = new CreateShaftCmd();

// Установка параметров команды
createShaftCmd.SetParameter("Tolerance", "IT7");
createShaftCmd.SetParameter("SurfaceFinish", "Ra1.6");
createShaftCmd.SetParameter("Units", "mm");
createShaftCmd.SetParameter("Precision", "0.001");

// Проверка параметров
string tolerance = createShaftCmd.GetParameter("Tolerance");
string surfaceFinish = createShaftCmd.GetParameter("SurfaceFinish");

Console.WriteLine($"Допуск: {tolerance}");
Console.WriteLine($"Шероховатость: {surfaceFinish}");

// Валидация перед выполнением
if (createShaftCmd.Validate())
{
    Console.WriteLine("Команда готова к выполнению");
}
else
{
    Console.WriteLine("Команда не может быть выполнена");
}
```

### Пример обработки событий создания

```csharp
public class ShaftCreationHandler
{
    private CreateShaftCmd _createShaftCmd;
    
    public ShaftCreationHandler()
    {
        _createShaftCmd = new CreateShaftCmd();
        
        // Подписка на события
        _createShaftCmd.CreationCompleted += OnCreationCompleted;
        _createShaftCmd.CreationFailed += OnCreationFailed;
    }
    
    public bool CreateShaft(Document doc, ShaftData data)
    {
        try
        {
            return _createShaftCmd.Run(doc, data);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Ошибка при создании вала: {ex.Message}");
            return false;
        }
    }
    
    private void OnCreationCompleted(object sender, EventArgs e)
    {
        Console.WriteLine("Создание вала успешно завершено");
        Console.WriteLine($"Дата создания: {_createShaftCmd.CreationDate}");
        
        // Дополнительная обработка после создания
        PostProcessCreatedShaft();
    }
    
    private void OnCreationFailed(object sender, CreationErrorEventArgs e)
    {
        Console.WriteLine($"Ошибка при создании вала: {e.ErrorMessage}");
        Console.WriteLine($"Код ошибки: {e.ErrorCode}");
        
        // Обработка ошибки
        HandleCreationError(e);
    }
    
    private void PostProcessCreatedShaft()
    {
        // Дополнительная обработка созданного вала
        if (_createShaftCmd.ModelObject != null)
        {
            // Установка атрибутов
            _createShaftCmd.ModelObject.SetAttribute("Material", _createShaftCmd.Data.Material);
            _createShaftCmd.ModelObject.SetAttribute("Standard", _createShaftCmd.Data.Standard);
            
            // Установка цвета
            _createShaftCmd.ModelObject.SetColor(Color.SteelBlue);
            
            // Обновление отображения
            _createShaftCmd.RegenerateDoc();
        }
    }
    
    private void HandleCreationError(CreationErrorEventArgs e)
    {
        // Обработка различных типов ошибок
        switch (e.ErrorCode)
        {
            case CreationErrorCode.InvalidData:
                Console.WriteLine("Некорректные данные вала");
                break;
            case CreationErrorCode.DocumentError:
                Console.WriteLine("Ошибка документа T-Flex CAD");
                break;
            case CreationErrorCode.GeometryError:
                Console.WriteLine("Ошибка геометрии");
                break;
            default:
                Console.WriteLine("Неизвестная ошибка");
                break;
        }
    }
}
```

## Паттерны использования

### Паттерн команда (Command)

CreateShaftCmd реализует паттерн команда для инкапсуляции операции создания вала в объекте команды.

### Паттерн строитель (Builder)

CreateShaftCmd использует паттерн строитель для пошагового создания сложной трехмерной модели вала.

### Паттерн фабричный метод (Factory Method)

CreateShaftCmd реализует фабричный метод для создания различных типов геометрических примитивов.

### Паттерн наблюдатель (Observer)

CreateShaftCmd реализует паттерн наблюдатель через события CreationCompleted и CreationFailed для уведомления подписчиков.

## Ограничения и особенности

### Ограничения

1. Document не может быть null при выполнении команды
2. ShaftData не может быть null при выполнении команды
3. Fragment не может быть null при установке переменных
4. Параметры хранятся в словаре, который не может быть null
5. Дата создания не может быть минимальной датой

### Особенности

1. CreateShaftCmd автоматически инициализирует коллекции в конструкторе
2. CreateShaftCmd поддерживает параметрическое моделирование через переменные фрагмента
3. CreateShaftCmd поддерживает событийную модель для уведомления о результатах
4. CreateShaftCmd реализует валидацию данных перед выполнением
5. CreateShaftCmd поддерживает очистку созданных объектов
6. CreateShaftCmd интегрируется с системой локальных координат T-Flex CAD
7. CreateShaftCmd поддерживает регенерацию документа после создания

## Лучшие практики

### Рекомендации по использованию

1. Всегда проверяйте корректность данных перед выполнением команды
2. Используйте метод Validate() для проверки возможности выполнения
3. Подписывайтесь на события для обработки результатов создания
4. Используйте параметры для настройки процесса создания
5. Очищайте созданные объекты при необходимости повторного использования
6. Обрабатывайте исключения при выполнении команды
7. Используйте параметрические переменные для гибкости модели
8. Регенерируйте документ после создания модели

### Антипаттерны

1. Не выполняйте команду без проверки корректности данных
2. Не игнорируйте события ошибок создания
3. Не создавайте циклические ссылки между объектами команды
4. Не храните большие объемы данных в параметрах команды
5. Не используйте команду вне контекста T-Flex CAD
6. Не забывайте регенерировать документ после создания модели

## Интеграция с другими компонентами

### ShaftData

CreateShaftCmd использует ShaftData для получения параметров создаваемого вала.

### ShaftCommand

CreateShaftCmd наследуется от ShaftCommand для получения базовой функциональности команды.

### Document

CreateShaftCmd использует Document для создания объектов модели и управления документом.

### Utils

CreateShaftCmd может использовать утилитарные классы для вспомогательных операций.

### ModelObject

CreateShaftCmd создает и управляет объектами ModelObject для представления вала.

## Расширяемость

### Возможности расширения

1. Добавление новых методов для создания специализированных примитивов
2. Создание наследуемых классов для специализированных типов создания вала
3. Добавление новых событий для уведомления о специфических этапах создания
4. Расширение параметров для поддержки дополнительных настроек

### Ограничения расширяемости

1. Невозможно изменить сигнатуру основного метода Run без нарушения совместимости
2. Добавление новых обязательных параметров требует изменения существующего кода
3. Изменение типа возвращаемого значения методов нарушает обратную совместимость

## Производительность

### Влияние на производительность

1. Создание сложных геометрических примитивов может быть ресурсоемким
2. Регенерация документа может занимать значительное время
3. Установка большого количества переменных может снижать производительность
4. Обработка событий может добавлять накладные расходы

### Оптимизация

1. Используйте пакетную обработку для установки множества переменных
2. Оптимизируйте геометрические примитивы для уменьшения сложности модели
3. Минимизируйте количество регенераций документа
4. Используйте асинхронные операции для длительных процессов

## Безопасность

### Потенциальные проблемы безопасности

1. Некорректные данные могут привести к ошибкам в геометрии
2. Неправильная обработка событий может привести к исключениям
3. Использование некорректных параметров может привести к непредсказуемому поведению
4. Циклические ссылки могут привести к утечкам памяти

### Рекомендации по безопасности

1. Всегда проверяйте данные перед выполнением команды
2. Используйте значения по умолчанию для обработки некорректных данных
3. Документируйте допустимые значения параметров команды
4. Используйте защитное программирование при работе с командой

## Совместимость

### Обратная совместимость

1. Добавление новых методов не нарушает обратную совместимость
2. Изменение сигнатур существующих методов нарушает обратную совместимость
3. Удаление методов нарушает обратную совместимость
4. Добавление новых свойств не нарушает обратную совместимость

### Совместимость с другими версиями

1. CreateShaftCmd совместим с предыдущими версиями T-Flex CAD API
2. Изменения в CreateShaftCmd могут потребовать обновления существующего кода
3. Новые свойства CreateShaftCmd могут не поддерживаться старыми версиями API

## Тестирование

### Рекомендации по тестированию

1. Тестируйте выполнение команды с различными комбинациями данных
2. Тестируйте обработку некорректных данных
3. Тестируйте производительность операций создания
4. Тестируйте обработку событий создания
5. Тестируйте работу с параметрами команды
6. Тестируйте валидацию данных перед выполнением

### Тестовые сценарии

1. Выполнение команды с корректными данными вала
2. Выполнение команды с некорректными данными вала
3. Обработка событий успешного создания
4. Обработка событий ошибок создания
5. Работа с параметрами команды
6. Валидация данных перед выполнением
7. Очистка созданных объектов
8. Регенерация документа после создания

## Документация

### Рекомендации по документированию

1. Документируйте все свойства CreateShaftCmd
2. Документируйте использование CreateShaftCmd в коде
3. Документируйте паттерны использования CreateShaftCmd
4. Документируйте ограничения и особенности CreateShaftCmd
5. Документируйте лучшие практики использования CreateShaftCmd
6. Документируйте работу с параметрами и событиями

### Примеры документации

```csharp
/// <summary>
/// Реализует команду создания трехмерной модели вала в системе T-Flex CAD
/// </summary>
public class CreateShaftCmd : ShaftCommand, ICommand
{
    /// <summary>
    /// Данные вала для создания
    /// </summary>
    public ShaftData Data { get; set; }
    
    /// <summary>
    /// Документ T-Flex CAD
    /// </summary>
    public Document Document { get; set; }
    
    // Другие свойства...
}
```

## Связанные компоненты

### ShaftData

ShaftData используется в CreateShaftCmd для получения параметров создаваемого вала.

### ShaftCommand

ShaftCommand является базовым классом для CreateShaftCmd.

### Document

Document используется в CreateShaftCmd для создания объектов модели.

### ModelObject

ModelObject создается и управляется в CreateShaftCmd.

## История изменений

### Версия 1.0

- Первоначальная реализация CreateShaftCmd
- Добавлены базовые методы создания вала (Run, CreateShaft)
- Добавлены методы работы с примитивами (CreatePrimitives, CreateLCS)

### Версия 1.1

- Добавлены методы работы с переменными (CreateVariablesInFragment, SetFragmentVariable)
- Добавлены события уведомления (CreationCompleted, CreationFailed)
- Добавлены методы валидации и очистки

### Версия 1.2

- Добавлены методы работы с параметрами
- Улучшена документация методов
- Добавлены примеры использования

### Версия 1.3

- Добавлены методы регенерации документа
- Улучшена обработка ошибок
- Добавлены дополнительные проверки данных

## Рекомендации по использованию в RAG-системах

### Индексация

1. Индексируйте все свойства CreateShaftCmd как отдельные атрибуты
2. Индексируйте описание каждого свойства CreateShaftCmd
3. Индексируйте примеры использования CreateShaftCmd
4. Индексируйте паттерны использования CreateShaftCmd
5. Индексируйте ограничения и особенности CreateShaftCmd
6. Индексируйте информацию о методах и событиях

### Поиск

1. Поддерживайте поиск по названию свойств CreateShaftCmd
2. Поддерживайте поиск по описанию свойств CreateShaftCmd
3. Поддерживайте поиск по примерам использования CreateShaftCmd
4. Поддерживайте поиск по паттернам использования CreateShaftCmd
5. Поддерживайте поиск по ограничениям и особенностям CreateShaftCmd
6. Поддерживайте поиск по типам событий и параметров

### Рекомендации

1. Рекомендуйте свойства CreateShaftCmd на основе контекста использования
2. Рекомендуйте примеры использования CreateShaftCmd на основе текущей задачи
3. Рекомендуйте паттерны использования CreateShaftCmd на основе типа проекта
4. Рекомендуйте ограничения и особенности CreateShaftCmd на основе требований к производительности
5. Рекомендуйте лучшие практики использования CreateShaftCmd на основе анализа кода
6. Рекомендуйте использование параметров и событий для специфических случаев