# База знаний DialogData для RAG-системы T-Flex CAD API

## Общая информация

**Название класса:** DialogData
**Пространство имен:** TFlex.Shaft.Plugin.Interface
**Тип:** Класс данных (Data Class)
**Назначение:** Представляет данные диалогового окна для системы проектирования валов T-Flex CAD

## Описание

DialogData - это класс данных, который представляет информацию, отображаемую и редактируемую в диалоговом окне системы проектирования валов T-Flex CAD. Класс содержит коллекции ступеней, отверстий и других элементов вала, а также информацию о текущем состоянии диалога. DialogData используется как основной контейнер данных для взаимодействия с пользовательским интерфейсом.

## Структура класса

### Свойства

#### Steps
**Тип:** List<ShaftStep>
**Описание:** Список ступеней вала
**Назначение:** Хранит информацию о всех ступенях вала, отображаемых в диалоге
**Ограничения:** Может быть пустым, но не null

#### Holes
**Тип:** List<ShaftHole>
**Описание:** Список отверстий в валу
**Назначение:** Хранит информацию о всех отверстиях в валу, отображаемых в диалоге
**Ограничения:** Может быть пустым, но не null

#### Elements
**Тип:** List<Element>
**Описание:** Список элементов вала
**Назначение:** Хранит информацию о всех конструктивных элементах вала, отображаемых в диалоге
**Ограничения:** Может быть пустым, но не null

#### SelectedStep
**Тип:** ShaftStep
**Описание:** Выбранная ступень
**Назначение:** Хранит ссылку на текущую выбранную ступень в диалоге
**Допустимые значения:** null или объект ShaftStep

#### SelectedHole
**Тип:** ShaftHole
**Описание:** Выбранное отверстие
**Назначение:** Хранит ссылку на текущее выбранное отверстие в диалоге
**Допустимые значения:** null или объект ShaftHole

#### SelectedElement
**Тип:** Element
**Описание:** Выбранный элемент
**Назначение:** Хранит ссылку на текущий выбранный конструктивный элемент в диалоге
**Допустимые значения:** null или объект Element

#### IsModified
**Тип:** bool
**Описание:** Флаг модификации данных
**Назначение:** Указывает, были ли изменены данные в диалоге
**Значения:** true/false

#### IsValid
**Тип:** bool
**Описание:** Флаг валидности данных
**Назначение:** Указывает, являются ли данные корректными
**Значения:** true/false

#### ValidationErrors
**Тип:** List<string>
**Описание:** Список ошибок валидации
**Назначение:** Хранит информацию об ошибках в данных диалога
**Ограничения:** Может быть пустым, но не null

#### Name
**Тип:** string
**Описание:** Имя диалога/вала
**Назначение:** Идентификатор диалога для отображения пользователю
**Ограничения:** Может быть null или пустой строкой

#### Description
**Тип:** string
**Описание:** Описание диалога/вала
**Назначение:** Дополнительная информация о диалоге/вале
**Ограничения:** Может быть null

#### Material
**Тип:** string
**Описание:** Материал вала
**Назначение:** Определяет материал, из которого изготовлен вал
**Ограничения:** Может быть null или пустой строкой

#### Standard
**Тип:** string
**Описание:** Стандарт вала
**Назначение:** Определяет стандарт, по которому изготовлен вал (ГОСТ, ISO и т.д.)
**Ограничения:** Может быть null или пустой строкой

#### Notes
**Тип:** string
**Описание:** Примечания к диалогу/валу
**Назначение:** Дополнительная информация, комментарии к диалогу/валу
**Ограничения:** Может быть null

#### Parameters
**Тип:** Dictionary<string, object>
**Описание:** Дополнительные параметры диалога
**Назначение:** Хранит специфические параметры для диалога
**Ограничения:** Может быть пустым, но не null

### Конструкторы

#### Конструктор по умолчанию
```csharp
public DialogData()
{
    Steps = new List<ShaftStep>();
    Holes = new List<ShaftHole>();
    Elements = new List<Element>();
    ValidationErrors = new List<string>();
    Parameters = new Dictionary<string, object>();
    IsModified = false;
    IsValid = true;
}
```

#### Конструктор с параметрами
```csharp
public DialogData(string name, string description)
{
    Name = name;
    Description = description;
    Steps = new List<ShaftStep>();
    Holes = new List<ShaftHole>();
    Elements = new List<Element>();
    ValidationErrors = new List<string>();
    Parameters = new Dictionary<string, object>();
    IsModified = false;
    IsValid = true;
}
```

## API информация

### Методы

#### AddStep(ShaftStep step)
**Возвращаемый тип:** void
**Описание:** Добавляет ступень в список ступеней
**Назначение:** Используется для добавления новой ступени в диалог
**Параметры:** step (ShaftStep) - добавляемая ступень
**Исключения:** ArgumentNullException если step равен null

#### RemoveStep(ShaftStep step)
**Возвращаемый тип:** bool
**Описание:** Удаляет ступень из списка ступеней
**Назначение:** Используется для удаления ступени из диалога
**Параметры:** step (ShaftStep) - удаляемая ступень
**Исключения:** Не генерирует исключений

#### AddHole(ShaftHole hole)
**Возвращаемый тип:** void
**Описание:** Добавляет отверстие в список отверстий
**Назначение:** Используется для добавления нового отверстия в диалог
**Параметры:** hole (ShaftHole) - добавляемое отверстие
**Исключения:** ArgumentNullException если hole равен null

#### RemoveHole(ShaftHole hole)
**Возвращаемый тип:** bool
**Описание:** Удаляет отверстие из списка отверстий
**Назначение:** Используется для удаления отверстия из диалога
**Параметры:** hole (ShaftHole) - удаляемое отверстие
**Исключения:** Не генерирует исключений

#### AddElement(Element element)
**Возвращаемый тип:** void
**Описание:** Добавляет элемент в список элементов
**Назначение:** Используется для добавления нового конструктивного элемента в диалог
**Параметры:** element (Element) - добавляемый элемент
**Исключения:** ArgumentNullException если element равен null

#### RemoveElement(Element element)
**Возвращаемый тип:** bool
**Описание:** Удаляет элемент из списка элементов
**Назначение:** Используется для удаления конструктивного элемента из диалога
**Параметры:** element (Element) - удаляемый элемент
**Исключения:** Не генерирует исключений

#### Validate()
**Возвращаемый тип:** bool
**Описание:** Проверяет корректность всех данных диалога
**Назначение:** Используется для валидации данных диалога
**Параметры:** Нет
**Исключения:** Не генерирует исключений

#### Clear()
**Возвращаемый тип:** void
**Описание:** Очищает все данные диалога
**Назначение:** Используется для сброса состояния диалога
**Параметры:** Нет
**Исключения:** Не генерирует исключений

#### Clone()
**Возвращаемый тип:** DialogData
**Описание:** Создает копию данных диалога
**Назначение:** Используется для операций копирования/вставки
**Параметры:** Нет
**Исключения:** Не генерирует исключений

#### ToString()
**Возвращаемый тип:** string
**Описание:** Возвращает строковое представление данных диалога
**Назначение:** Используется для отображения в интерфейсе
**Параметры:** Нет
**Исключения:** Не генерирует исключений

#### GetParameter<T>(string key)
**Возвращаемый тип:** T
**Описание:** Получает значение дополнительного параметра диалога
**Назначение:** Используется для доступа к специфическим параметрам диалога
**Параметры:** key (string) - ключ параметра
**Исключения:** ArgumentException если параметр не найден или имеет неверный тип

#### SetParameter<T>(string key, T value)
**Возвращаемый тип:** void
**Описание:** Устанавливает значение дополнительного параметра диалога
**Назначение:** Используется для установки специфических параметров диалога
**Параметры:** key (string) - ключ параметра, value (T) - значение параметра
**Исключения:** Не генерирует исключений

#### SortSteps()
**Возвращаемый тип:** void
**Описание:** Сортирует ступени по позиции
**Назначение:** Используется для упорядочивания ступеней в диалоге
**Параметры:** Нет
**Исключения:** Не генерирует исключений

#### SortHoles()
**Возвращаемый тип:** void
**Описание:** Сортирует отверстия по позиции
**Назначение:** Используется для упорядочивания отверстий в диалоге
**Параметры:** Нет
**Исключения:** Не генерирует исключений

#### SortElements()
**Возвращаемый тип:** void
**Описание:** Сортирует элементы по позиции
**Назначение:** Используется для упорядочивания элементов в диалоге
**Параметры:** Нет
**Исключения:** Не генерирует исключений

### События

#### DataChanged
**Тип:** EventHandler<EventArgs>
**Описание:** Событие изменения данных
**Назначение:** Уведомляет подписчиков об изменении данных диалога
**Параметры:** sender (object), e (EventArgs)

#### SelectionChanged
**Тип:** EventHandler<EventArgs>
**Описание:** Событие изменения выбора
**Назначение:** Уведомляет подписчиков об изменении выбора элементов
**Параметры:** sender (object), e (EventArgs)

#### ValidationChanged
**Тип:** EventHandler<EventArgs>
**Описание:** Событие изменения валидации
**Назначение:** Уведомляет подписчиков об изменении состояния валидации
**Параметры:** sender (object), e (EventArgs)

## Использование в коде

### Пример создания данных диалога

```csharp
// Создание пустых данных диалога
DialogData dialogData = new DialogData();

// Создание данных диалога с параметрами
DialogData dialogDataWithParams = new DialogData
{
    Name = "Проект вала",
    Description = "Основной проект вала для редуктора",
    Material = "Сталь 45",
    Standard = "ГОСТ 12081-76"
};

// Добавление ступеней
ShaftStep step1 = new ShaftStep(PrimitiveType.Cylinder, 50.0, 100.0)
{
    Name = "Основная ступень",
    Position = 0.0
};
dialogDataWithParams.AddStep(step1);

ShaftStep step2 = new ShaftStep(PrimitiveType.Cone, 60.0, 50.0)
{
    Name = "Коническая ступень",
    Position = 100.0
};
dialogDataWithParams.AddStep(step2);

// Добавление отверстий
ShaftHole hole1 = new ShaftHole(HoleType.Radial, 10.0, 50.0)
{
    Name = "Радиальное отверстие",
    Angle = 0.0,
    Offset = 25.0
};
dialogDataWithParams.AddHole(hole1);

ShaftHole hole2 = new ShaftHole(HoleType.End, 12.0, 0.0)
{
    Name = "Торцевое отверстие",
    IsThrough = true
};
dialogDataWithParams.AddHole(hole2);

// Добавление элементов
Element keyElement = new Element
{
    Type = ElementType.Key,
    Name = "Шпонка 10x8x30",
    Position = 75.0,
    Diameter = 10.0,
    Width = 8.0,
    Depth = 5.0
};
dialogDataWithParams.AddElement(keyElement);
```

### Пример работы с данными диалога

```csharp
// Работа с данными диалога
DialogData dialogData = new DialogData("Тестовый проект", "Тестовый проект вала");

// Добавление ступеней
for (int i = 0; i < 5; i++)
{
    ShaftStep step = new ShaftStep(PrimitiveType.Cylinder, 40.0 + i * 5, 50.0)
    {
        Name = $"Ступень {i + 1}",
        Position = i * 50.0,
        Index = i
    };
    dialogData.AddStep(step);
}

// Добавление отверстий
for (int i = 0; i < 3; i++)
{
    ShaftHole hole = new ShaftHole(HoleType.Radial, 8.0, i * 75.0)
    {
        Name = $"Отв. {i + 1}",
        Angle = i * 120.0,
        Offset = 20.0,
        Index = i
    };
    dialogData.AddHole(hole);
}

// Добавление элементов
Element[] elements = {
    new Element(ElementType.Key, "Шпонка 1", 25.0),
    new Element(ElementType.Ring, "Кольцо 1", 100.0),
    new Element(ElementType.Groove, "Канавка 1", 150.0)
};

foreach (var element in elements)
{
    dialogData.AddElement(element);
}

// Сортировка элементов
dialogData.SortSteps();
dialogData.SortHoles();
dialogData.SortElements();

// Проверка валидности
if (dialogData.Validate())
{
    Console.WriteLine("Данные диалога корректны");
}
else
{
    Console.WriteLine("Данные диалога содержат ошибки:");
    foreach (var error in dialogData.ValidationErrors)
    {
        Console.WriteLine($"  - {error}");
    }
}
```

### Пример валидации данных диалога

```csharp
public bool ValidateDialogData(DialogData dialogData)
{
    if (dialogData == null)
        return false;
        
    dialogData.ValidationErrors.Clear();
    
    // Проверка имени
    if (string.IsNullOrEmpty(dialogData.Name))
    {
        dialogData.ValidationErrors.Add("Имя проекта не может быть пустым");
    }
    
    // Проверка ступеней
    foreach (var step in dialogData.Steps)
    {
        if (!step.Validate())
        {
            dialogData.ValidationErrors.Add($"Некорректная ступень: {step.Name}");
        }
    }
    
    // Проверка отверстий
    foreach (var hole in dialogData.Holes)
    {
        if (!hole.Validate())
        {
            dialogData.ValidationErrors.Add($"Некорректное отверстие: {hole.Name}");
        }
    }
    
    // Проверка элементов
    foreach (var element in dialogData.Elements)
    {
        if (!element.Validate())
        {
            dialogData.ValidationErrors.Add($"Некорректный элемент: {element.Name}");
        }
    }
    
    // Проверка пересечений ступеней
    for (int i = 0; i < dialogData.Steps.Count - 1; i++)
    {
        for (int j = i + 1; j < dialogData.Steps.Count; j++)
        {
            if (CheckStepOverlap(dialogData.Steps[i], dialogData.Steps[j]))
            {
                dialogData.ValidationErrors.Add(
                    $"Пересечение ступеней: {dialogData.Steps[i].Name} и {dialogData.Steps[j].Name}");
            }
        }
    }
    
    dialogData.IsValid = dialogData.ValidationErrors.Count == 0;
    return dialogData.IsValid;
}

private bool CheckStepOverlap(ShaftStep step1, ShaftStep step2)
{
    // Проверка пересечения ступеней по позиции
    double start1 = step1.Position;
    double end1 = step1.Position + step1.Length;
    double start2 = step2.Position;
    double end2 = step2.Position + step2.Length;
    
    return (start1 < end2) && (start2 < end1);
}
```

## Паттерны использования

### Паттерн построитель (Builder)

DialogData используется в паттерне построитель для создания сложных конфигураций данных диалога.

### Паттерн наблюдатель (Observer)

DialogData реализует паттерн наблюдатель через события DataChanged, SelectionChanged и ValidationChanged для уведомления подписчиков об изменениях.

### Паттерн прототип (Prototype)

DialogData реализует паттерн прототип через метод Clone() для создания копий данных диалога.

### Паттерн фасад (Facade)

DialogData используется как фасад для доступа к различным типам данных (ступени, отверстия, элементы) в едином интерфейсе.

## Ограничения и особенности

### Ограничения

1. Списки Steps, Holes, Elements, ValidationErrors не могут быть null
2. Имя диалога может быть null или пустой строкой
3. Выбранные элементы могут быть null
4. Дополнительные параметры хранятся в словаре, который не может быть null

### Особенности

1. DialogData автоматически инициализирует все коллекции в конструкторе
2. DialogData поддерживает уведомления об изменениях через события
3. DialogData реализует методы сортировки элементов
4. DialogData поддерживает клонирование для операций копирования
5. DialogData поддерживает валидацию всех данных
6. DialogData поддерживает дополнительные параметры через словарь

## Лучшие практики

### Рекомендации по использованию

1. Всегда проверяйте корректность данных диалога перед использованием
2. Используйте метод Validate() для проверки целостности данных
3. Используйте события для отслеживания изменений
4. Используйте метод Clone() для безопасного копирования данных диалога
5. Используйте сортировку элементов для упорядоченного отображения
6. Используйте дополнительные параметры для хранения специфических данных
7. Инициализируйте все обязательные свойства при создании данных диалога

### Антипаттерны

1. Не изменяйте данные диалога напрямую без уведомления подписчиков
2. Не игнорируйте проверку корректности данных
3. Не создавайте циклические ссылки между элементами данных
4. Не храните большие объемы данных в свойствах диалога
5. Не используйте данные диалога вне контекста пользовательского интерфейса

## Интеграция с другими компонентами

### GeneralDialog

DialogData используется в классе GeneralDialog как основной источник данных для отображения и редактирования параметров вала.

### ShaftData

DialogData используется для передачи данных между пользовательским интерфейсом и внутренним представлением данных вала.

### CreateShaftCmd

DialogData используется в классе CreateShaftCmd для получения параметров вала из пользовательского интерфейса.

### Utils

DialogData может использоваться в утилитарных классах для валидации данных и преобразования форматов.

## Расширяемость

### Возможности расширения

1. Добавление новых свойств для расширения функциональности данных диалога
2. Создание методов расширения для добавления дополнительных возможностей
3. Создание наследуемых классов для специализированных типов данных диалога
4. Добавление новых событий для уведомления о специфических изменениях

### Ограничения расширяемости

1. Невозможно изменить тип существующих свойств без нарушения совместимости
2. Добавление новых обязательных свойств требует изменения существующего кода
3. Изменение сигнатур существующих методов нарушает обратную совместимость
4. Добавление новых значений в перечисления может повлиять на существующий код

## Производительность

### Влияние на производительность

1. Создание большого количества данных диалога может потреблять значительный объем памяти
2. Частое уведомление об изменениях через события может снижать производительность
3. Валидация больших наборов данных может быть ресурсоемкой
4. Клонирование данных диалога с большими объемами данных может быть медленным
5. Работа с дополнительными параметрами через словарь может быть менее эффективной

### Оптимизация

1. Используйте пулы объектов для повторного использования данных диалога
2. Ограничьте частоту уведомлений об изменениях
3. Кэшируйте результаты валидации
4. Используйте ленивую инициализацию для сложных вычислений
5. Используйте типизированные свойства вместо словаря для часто используемых параметров

## Безопасность

### Потенциальные проблемы безопасности

1. Небезопасное использование данных диалога может привести к некорректному отображению
2. Неправильная обработка событий изменений может привести к исключениям
3. Использование некорректных данных диалога может привести к непредсказуемому поведению
4. Циклические ссылки между элементами данных могут привести к утечкам памяти
5. Небезопасная работа с дополнительными параметрами может привести к исключениям

### Рекомендации по безопасности

1. Всегда проверяйте данные диалога перед использованием
2. Используйте значения по умолчанию для обработки некорректных данных
3. Документируйте допустимые значения параметров данных диалога
4. Используйте защитное программирование при работе с данными диалога
5. Проверяйте типы дополнительных параметров перед их использованием

## Совместимость

### Обратная совместимость

1. Добавление новых свойств не нарушает обратную совместимость
2. Изменение типов существующих свойств нарушает обратную совместимость
3. Удаление свойств нарушает обратную совместимость
4. Добавление новых методов не нарушает обратную совместимость

### Совместимость с другими версиями

1. DialogData совместим с предыдущими версиями T-Flex CAD API
2. Изменения в DialogData могут потребовать обновления существующего кода
3. Новые свойства DialogData могут не поддерживаться старыми версиями API

## Тестирование

### Рекомендации по тестированию

1. Тестируйте все возможные комбинации данных диалога
2. Тестируйте обработку некорректных значений данных
3. Тестируйте производительность операций с большими наборами данных
4. Тестируйте уведомления об изменениях через события
5. Тестируйте методы валидации данных
6. Тестируйте работу с дополнительными параметрами

### Тестовые сценарии

1. Создание данных диалога с различными комбинациями элементов
2. Валидация данных диалога с корректными и некорректными параметрами
3. Клонирование данных диалога и проверка независимости копии
4. Сортировка элементов данных диалога
5. Работа с дополнительными параметрами данных диалога
6. Обработка событий изменений данных диалога

## Документация

### Рекомендации по документированию

1. Документируйте все свойства DialogData
2. Документируйте использование DialogData в коде
3. Документируйте паттерны использования DialogData
4. Документируйте ограничения и особенности DialogData
5. Документируйте лучшие практики использования DialogData
6. Документируйте работу с дополнительными параметрами

### Примеры документации

```csharp
/// <summary>
/// Представляет данные диалогового окна для системы проектирования валов T-Flex CAD
/// </summary>
public class DialogData
{
    /// <summary>
    /// Список ступеней вала
    /// </summary>
    public List<ShaftStep> Steps { get; set; }
    
    /// <summary>
    /// Список отверстий в валу
    /// </summary>
    public List<ShaftHole> Holes { get; set; }
    
    /// <summary>
    /// Список элементов вала
    /// </summary>
    public List<Element> Elements { get; set; }
    
    // Другие свойства...
}
```

## Связанные компоненты

### GeneralDialog

GeneralDialog использует DialogData для отображения и редактирования параметров вала.

### ShaftStep

ShaftStep используется в DialogData для хранения информации о ступенях вала.

### ShaftHole

ShaftHole используется в DialogData для хранения информации об отверстиях в валу.

### Element

Element используется в DialogData для хранения информации о конструктивных элементах вала.

## История изменений

### Версия 1.0

- Первоначальная реализация DialogData
- Добавлены базовые коллекции (Steps, Holes, Elements)
- Добавлены свойства выбора (SelectedStep, SelectedHole, SelectedElement)

### Версия 1.1

- Добавлены свойства идентификации (Name, Description)
- Добавлены свойства материалов и стандартов (Material, Standard)
- Добавлены свойства состояния (IsModified, IsValid, ValidationErrors)

### Версия 1.2

- Добавлены события уведомления об изменениях
- Добавлен метод клонирования
- Добавлены методы валидации
- Добавлены методы работы с дополнительными параметрами

### Версия 1.3

- Добавлены методы сортировки элементов
- Добавлено свойство примечаний (Notes)
- Улучшена документация свойств
- Добавлены примеры использования

## Рекомендации по использованию в RAG-системах

### Индексация

1. Индексируйте все свойства DialogData как отдельные атрибуты
2. Индексируйте описание каждого свойства DialogData
3. Индексируйте примеры использования DialogData
4. Индексируйте паттерны использования DialogData
5. Индексируйте ограничения и особенности DialogData
6. Индексируйте информацию о событиях и методах

### Поиск

1. Поддерживайте поиск по названию свойств DialogData
2. Поддерживайте поиск по описанию свойств DialogData
3. Поддерживайте поиск по примерам использования DialogData
4. Поддерживайте поиск по паттернам использования DialogData
5. Поддерживайте поиск по ограничениям и особенностям DialogData
6. Поддерживайте поиск по типам элементов данных

### Рекомендации

1. Рекомендуйте свойства DialogData на основе контекста использования
2. Рекомендуйте примеры использования DialogData на основе текущей задачи
3. Рекомендуйте паттерны использования DialogData на основе типа проекта
4. Рекомендуйте ограничения и особенности DialogData на основе требований к производительности
5. Рекомендуйте лучшие практики использования DialogData на основе анализа кода
6. Рекомендуйте использование дополнительных параметров для специфических случаев