

Руководство по T-FLEX CAD Open API

# Общие положения  
  
---  
  
Класс [Graphics](T_TFlex_Drawing_Graphics.md) предназначен для прорисовки двухмерных изображений в видах документа, прорисовки документов и других изображений в окнах приложений.

Доступ к объекту данного класса можно получить следующими способами:

  1. При обработке различных уведомлений, поступающих от системы в приложение объект обычно передаётся в качестве члена класса объекта аргументов метода-обработчика.
  2. При получении команды приложение может получить объект при помощи метода у активного или другого вида документа.
  3. При реализации графического объекта приложения со своим поведением такой объект передаётся в виртуальный метод, выполняющий прорисовку объекта приложения.
  4. Для прорисовки документа, отдельных объектов документа или независимых изображений объект данного класса может быть создан при помощи конструктора на основе дескриптора окна или дескриптора контекста графического устройства, доступных приложению.



Внимание  
---  
В том случае, если объект данного класса создан пользователем явно, то после окончания использования этого объекта для правильного и своевременного освобождения ресурсов следует вызвать метод [Dispose](M_TFlex_Drawing_Graphics_Dispose.md).  
  
Внимание  
---  
Вывод любого графического изображения при помощи данного класса должен обязательно начинаться с вызова метода [BeginDraw](M_TFlex_Drawing_Graphics_BeginDraw.md), а заканчиваться вызовом [EndDraw](M_TFlex_Drawing_Graphics_EndDraw.md). Это необходимо для корректного создания системных объектов, реализующих вывод и корректного их освобождения.  
  
Примечание  
---  
Методы [BeginDraw](M_TFlex_Drawing_Graphics_BeginDraw.md) и [EndDraw](M_TFlex_Drawing_Graphics_EndDraw.md) могут быть вложенными.  
  
Ниже приведен пример вложенных методов [BeginDraw](M_TFlex_Drawing_Graphics_BeginDraw.md) и [EndDraw](M_TFlex_Drawing_Graphics_EndDraw.md).
    
    
    private void Draw1(Graphics graphics)
    {
        //Открываем блок рисования
        graphics.BeginDraw();
        //Вызываем функцию Draw2
        Draw2(graphics);
        //Закрываем блок рисования
        graphics.EndDraw();
    }
    private void Draw2(Graphics graphics)
    {
        //Открываем блок рисования
        graphics.BeginDraw();
        //Рисуем линию по двум точкам
        graphics.Line(new Point(100,100),new Point(200,100));
        //Закрываем блок рисования
        graphics.EndDraw();
    }
    
    
    Private Sub Draw1(ByVal graphics As Graphics)
        'Открываем блок рисования
        graphics.BeginDraw()
        'Вызываем функцию Draw2
        Draw2(graphics)
        'Закрываем блок рисования
        graphics.EndDraw()
    End Sub
    Private Sub Draw2(ByVal graphics As Graphics)
        'Открываем блок рисования
        graphics.BeginDraw()
        'Рисуем линию по двум точкам
        graphics.Line(new Point(100,100),new Point(200,100))
        'Закрываем блок рисования
        graphics.EndDraw()
    End Sub

В настоящее время язык не поддерживается либо пример кода отсутствует.

При помощи класса [Graphics](T_TFlex_Drawing_Graphics.md) можно создать объект системного класса System.Drawing.Graphics, позволяющий выводить изображения при помощи целочисленных функций. Для этого предназначены два метода [GetDeviceContext](M_TFlex_Drawing_Graphics_GetDeviceContext.md) и [ReleaseDeviceContext](M_TFlex_Drawing_Graphics_ReleaseDeviceContext.md). Данные методы должны также вызываться парой. При завершении работы с контекстом графического устройства, полученного при помощи [GetDeviceContext](M_TFlex_Drawing_Graphics_GetDeviceContext.md) обязателен вызов метода [ReleaseDeviceContext](M_TFlex_Drawing_Graphics_ReleaseDeviceContext.md) с передачей полученного прежде значения.

Ниже приведен пример использования функций [GetDeviceContext](M_TFlex_Drawing_Graphics_GetDeviceContext.md) и [ReleaseDeviceContext](M_TFlex_Drawing_Graphics_ReleaseDeviceContext.md).
    
    
    private void document_BeforeDraw(DocumentDrawEventArgs e)
    {
        //Получаем объект Graphics
        TFlex.Drawing.Graphics graphics = e.Graphics;
        //Открываем блок рисования
        graphics.BeginDraw();
        //Задаем прямоугольник вывода в системе координат графического устройства
        System.Drawing.Rectangle rect = graphics.LCSRectangle;
        //Получаем дескриптор
        IntPtr hdc = graphics.GetDeviceContext();
        //Создаем объект системного класса Graphics
        System.Drawing.Graphics gr = System.Drawing.Graphics.FromHdc(hdc);
        //Закрашиваем прямоугольник вывода
        gr.FillRectangle(new System.Drawing.Drawing2D.LinearGradientBrush(rect,System.Drawing.Color.White,System.Drawing.Color.Blue,45),rect.Left,rect.Top,rect.Right,rect.Bottom);
        //Освобождаем объект системного класса Graphics
        gr.Dispose();
        graphics.ReleaseDeviceContext(hdc);
        graphics.EndDraw();
    }
    
    
    Private Sub document_BeforeDraw(ByVal e As DocumentDrawEventArgs)
        'Получаем объект Graphics
        Dim graphics As TFlex.Drawing.Graphics
        graphics = e.Graphics
        'Открываем блок рисования
        graphics.BeginDraw()
        'Задаем прямоугольник вывода в системе координат графического устройства
        Dim rect As System.Drawing.Rectangle
        rect = graphics.LCSRectangle
        'Получаем дескриптор
        Dim hdc As IntPtr
        hdc = graphics.GetDeviceContext()
        'Создаем объект системного класса Graphics
        Dim gr As System.Drawing.Graphics
        gr = System.Drawing.Graphics.FromHdc(hdc)
        gr.FillRectangle(New System.Drawing.Drawing2D.LinearGradientBrush(rect, System.Drawing.Color.White, System.Drawing.Color.Blue, 45), rect.Left, rect.Top, rect.Right, rect.Bottom)
        gr.Dispose()
        graphics.ReleaseDeviceContext(hdc)
        graphics.EndDraw()
    End Sub

В настоящее время язык не поддерживается либо пример кода отсутствует.

#### Другие ресурсы

[Подсистема вывода двухмерной графики](17ff9665-04e6-4d51-9946-30838fe9d1ce.md)

[Вспомогательные структуры подсистемы вывода двухмерной графики](62d0fc1e-8909-403b-8a4d-a84b30894bb1.md)

[Преобразование координат](282e1397-8608-474c-b72b-b46f91ad378b.md)

[Вывод графических объектов](878d6837-24ed-4e9a-8058-415219723ae2.md)