

Руководство по T-FLEX CAD Open API

# Управление документом  
  
---  
  
Для общего управления документом предназначены следующие методы:

  * [Save](Overload_TFlex_Model_Document_Save.md) \- сохранение документа;
  * [SaveAs](M_TFlex_Model_Document_SaveAs.md) \- сохранение документа в файл с другим именем;
  * [Close](M_TFlex_Model_Document_Close.md) \- закрытие документа;
  * [Draw](M_TFlex_Model_Document_Draw.md) \- прорисовка документа в окно приложения или на другое устройство графического вывода;
  * [Redraw](Overload_TFlex_Model_Document_Redraw.md) \- перерисовка всех окон документа.



Ниже приведен пример использования функций [OpenDocument](Overload_TFlex_Application_OpenDocument.md) для открытия документа и [Save](Overload_TFlex_Model_Document_Save.md) и [Close](M_TFlex_Model_Document_Close.md) для сохранения и закрытия документа соответственно.
    
    
    private void OpenDocument()
    {
        //Создаем экземпляр диалога открытия файла
        OpenFileDialog openFileDlg = new OpenFileDialog();
        openFileDlg.Title = "Открыть документ";
        openFileDlg.Filter = "Документы T-FLEX CAD (*.grb)|*.grb";
        openFileDlg.FilterIndex = 1;
        //Если в диалоге нажата кнопка OK
        if (openFileDlg.ShowDialog() == DialogResult.OK)
        {
            //Открываем указанный в диалоге документ
            Document document = TFlex.Application.OpenDocument(openFileDlg.FileName);
            //Если экземпляр документа не нулевой
            if (document != null)
            {
                //Выводим сообщение о том, что документ открыт
                MessageBox.Show("Документ открыт!");
            }
        }
    }
    
    private void CloseDocument(Document document)
    {
        //Сохраняем документ
        document.Save();
        //Закрываем документ
        document.Close();
        //Обнуляем экземпляр документа
        document = null;
        //Выводим сообщение о том, что документ закрыт
        MessageBox.Show("Документ закрыт!");
    }
    
    
    Private Sub OpenDocument()
        'Создаем экземпляр диалога открытия файла
        Dim openFileDlg As OpenFileDialog
        openFileDlg = New OpenFileDialog()
        openFileDlg.Title = "Открыть документ"
        openFileDlg.Filter = "Документы T-FLEX CAD (*.grb)|*.grb"
        openFileDlg.FilterIndex = 1
        'Если в диалоге нажата кнопка OK
        If openFileDlg.ShowDialog() = DialogResult.OK Then
            'Открываем указанный в диалоге документ
            Dim document As Docuemnt
            document = TFlex.Application.OpenDocument(openFileDlg.FileName)
            'Если экземпляр документа не нулевой
            If Not document Is Nothing Then
                'Выводим сообщение о том, что документ открыт
                MessageBox.Show("Документ открыт!")
            End If
        End If
    End Sub
    
    Private Sub CloseDocument(ByVal document As Document)
        'Сохраняем документ
        document.Save()
        'Сохраняем документ
        document.Close()
        'Обнуляем экземпляр документа
        document = Nothing
        'Выводим сообщение о том, что документ закрыт
        MessageBox.Show("Документ закрыт!")
    End Sub

В настоящее время язык не поддерживается либо пример кода отсутствует.

В качестве примера использования метода [Draw](M_TFlex_Model_Document_Draw.md) приведем пример по созданию окна, способного просматривать документы T-FLEX CAD. Аргументами данного метода являются объект класса [Graphics](T_TFlex_Drawing_Graphics.md) и страница документа, которую необходимо вывести. В конструкторе класса [Graphics](T_TFlex_Drawing_Graphics.md) указывается дескриптор окна вывода, прямоугольник в системе координат устройства, в который производится вывод изображения, прямоугольник в мировой системе координат, соответствующий прямоугольнику в системе координат устройства. 

Внимание  
---  
Метод [Draw](M_TFlex_Model_Document_Draw.md) отображает только 2D вид документа.   
  
В примере для отображаения графических данных используется обработчик события [Paint](https://learn.microsoft.com/dotnet/api/system.windows.forms.control.paint) для элемента управления [PictureBox](https://learn.microsoft.com/dotnet/api/system.windows.forms.picturebox). 
    
    
    //Определяем экземпляр документа
    private Document document;
    //Определяем экземпляр класса Graphics
    private TFlex.Drawing.Graphics _grph;
    
    private void MyPictureBox_Paint(object sender, PaintEventArgs e)
    {
        if (document != null)
        {
            //Получаем дескриптор графического устройства
            IntPtr hdc = e.Graphics.GetHdc();
            //Если класс Graphics не инициализировался
            if (_grph == null)
                //Создаем экземпляр класса Graphics
                _grph = new TFlex.Drawing.Graphics(Handle, ClientRectangle, document.ActivePage.Rectangle);
            //Устанавливаем дескриптор устройства
            _grph.DeviceContext = hdc;
            //Прорисовываем страницу в объект Graphics
            document.Draw(_grph, document.ActivePage);
            //Освобождаем дескриптор, полученный через свойство DeviceContext объекта Graphics пространства имен TFlex.Drawing
            _grph.ReleaseDeviceContext(hdc);
            //Овобождаем дескриптор, полученный вызовом метода GetHdc системного объекта Graphics
            e.Graphics.ReleaseHdc(hdc);
        }
    }
    
    
    'Определяем экземпляр документа
    Private document As Document
    'Определяем экземпляр класса Graphics
    Private _grph As TFlex.Drawing.Graphics
    
    Private Sub MyPictureBox_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles MyPictureBox.Paint
        If Not document Is Nothing Then
            'Получаем дескриптор графического устройства
            Dim hdc As IntPtr
            hdc = e.Graphics.GetHdc()
            'Если класс Graphics не инициализировался
            If _grph Is Nothing Then
                'Создаем экземпляр класса Graphics
                _grph = New TFlex.Drawing.Graphics(Handle, ClientRectangle, document.ActivePage.Rectangle)
            End If
            'Устанавливаем дескриптор устройства
            _grph.DeviceContext = hdc
            'Прорисовываем страницу в объект Graphics
            document.Draw(_grph, document.ActivePage)
            'Освобождаем дескриптор, полученный через свойство DeviceContext объекта Graphics пространства имен TFlex.Drawing
            _grph.ReleaseDeviceContext(hdc)
            'Овобождаем дескриптор, полученный вызовом метода GetHdc системного объекта Graphics
            e.Graphics.ReleaseHdc(hdc)
        End If
    End Sub

В настоящее время язык не поддерживается либо пример кода отсутствует.

#### Другие ресурсы

[Общие положения о документах T-FLEX CAD](8e32df72-3613-4ebb-bdae-13e95f2057cb.md)

[Класс Graphics. Общие положения.](fd0e70f9-6abc-42ad-896b-9ae7523ad12e.md)